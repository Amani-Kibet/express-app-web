<!-- Chat Page -->
   <span id="chatPage">
  <div class="top-bar">
    <div style="display: flex; align-items: center;">
      <div class="settings-btn" id="settings">â˜°</div>
      <div class="user-info">
        <h2 id="nameinfo"></h2>
        <p id="phoneinfo"></p>
      </div>
    </div>
    <div id="pic"></div>
    <div class="dropdown" id="dropdown">
      <button onclick="toggleDarkMode()">ğŸŒ™ Dark Theme</button>
      <button onclick="openModal()">âš™ï¸ Settings</button>
      <button id="connected">ğŸ›œ See who is connected</button>
      <button id="profileInfoBtn">ğŸ‘¤ Profile Info</button>

      <button onclick="exit()">âŒ Exit chat</button>
    </div>
  </div>

  <!-- Chat Container -->
  <div class="chat-container" id="chat">
  </div>

  <!-- Chat Input -->
  <div class="chat-input">
    <input type="text" id="message" placeholder="Type a message..." />
    <button id="sendbtn">â¤</button>
  </div>

  <!-- Settings Modal -->
  <div class="modal" id="modal">
    <div class="modal-content">
      <h3>Settings</h3>
      <label>ğŸ¨ Pick Background Color</label><br>
      <input type="color" onchange="changeBackgroundColor(this.value)"><br>
      <label>ğŸ–¼ Upload Background</label><br>
      <input type="file" accept="image/*" onchange="uploadBackground(event)"><br>
      <button class="close-btn" onclick="closeModal()">Close</button>
    </div>
  </div>

  <!-- Profile Picture Zoom Modal -->
  <div class="pic-modal" id="picModal" onclick="closePicModal()">
  </div>
</span>

<div id="OnlineInfo" id="modal2" class="modal2">
  <div class="modal-content2">
    <span id="closemodal" class="close">&times;</span>
    <h2>Who's Online</h2>
    <ol id="onlineList"></ol>
  </div>
</div>




//Chat Page Inside Data
      pic.style.background= `url(/pictures/${data.info2.piclink})`;
      nameinfo.innerHTML= `${data.info2.name}`;
      phoneinfo.innerHTML= `${data.info2.phone}`;
      pic.style.backgroundSize= "cover";
  
      // Typing effect for bot
      function typeMessage(text, container) {
        container.style.whiteSpace = "pre-wrap";
        let i = 0;
        const interval = setInterval(() => {
          container.textContent += text.charAt(i);
          i++;
          if (i === text.length) clearInterval(interval);
        }, 50);
      }
      
      
      function send(){
        const input = document.getElementById("message");
        const text = input.value;
        if (text === "") return;
  
        const chat = document.getElementById("chat");
        const bubble = document.createElement("div");
        bubble.className = "chat-bubble chat-right";
        bubble.textContent = text;            // use textContent, not innerText
        bubble.style.whiteSpace = "pre-wrap";
        
        chat.appendChild(bubble);
        chat.scrollTop = chat.scrollHeight;
        input.value = "";
  
        fetch("/chat/path2", {
          method: "POST",
          headers: {"Content-Type":"application/json"},
          body: JSON.stringify({
            phone1: data.info1.phone,
            input: text,
            phone2: data.info2.phone
          })
        })
      };
      sendbt.addEventListener("click", send);
      messageBox.addEventListener("keydown", function(event) {
        if(event.key === "Enter") {
            event.preventDefault(); // prevent line break if textarea
            send();
        }
    });
      // Profile pic zoom modal
      const picModal = document.getElementById("picModal");
      const modalImg = document.getElementById("modalImg");
  
      pic.addEventListener("click", ()=>{
        picModal.style.display = "flex";
      });
  
      function closePicModal(){
        const img = document.querySelector("#picModal img");
        img.style.animation = "zoomOut 0.3s forwards";
        setTimeout(()=>{
          picModal.style.display = "none";
          img.style.animation = "zoomIn 0.4s forwards";
        }, 300);
      }

      let lastMessage = ""; // track last message

      setInterval(() => {
        fetch("/chat/path3", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ phone1: data.info1.phone })
        })
        .then(res => res.json())
        .then(data => {
          if (data.msg !== lastMessage) { // only act if message changed
            lastMessage = data.msg; // update lastMessage
      
            const typing = document.createElement("div");
            typing.className = "typing-indicator";
            chat.appendChild(typing);
            chat.scrollTop = chat.scrollHeight;
      
            setTimeout(() => {
              typing.remove();
      
              const reply = document.createElement("div");
              reply.className = "chat-bubble chat-left";
              reply.style.whiteSpace = "pre-wrap";
              chat.appendChild(reply);
      
              typeMessage(data.msg, reply);
              chat.scrollTop = chat.scrollHeight;
            }, 1500);
          }
        });
      }, 600);
      
    });
  }

  connected.addEventListener("click", ()=>{
  fetch("/path/online")
  .then(type=> type.json())
  .then(data=>{
    data.everyone.forEach((user, index)=>{
        const li = document.createElement("li");
        li.textContent = `${user.name}- ${user.phone}`;
        ol.appendChild(li);
        modal2.style.display="block"
    })
});
  })