<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <title>Chat</title>
  <style>
    /* ================= Reset & Base ================= */
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html, body {
  height: 100%;
  width: 100%;
  font-family: "Poppins", sans-serif;
  background: linear-gradient(135deg, #667eea, #764ba2);
  overflow-x: hidden;
  scroll-behavior: smooth;
}

body {
  display: flex;
  flex-direction: column;
  min-height: 100vh;
  color: #333;
  font-size: 16px;
}

/* ================= Top & Bottom Bars ================= */
.top-bar, .top-bar-log, .bottom-bar-log {
  width: 100%;
  box-sizing: border-box;
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0.8rem 1rem;
  color: white;
  z-index: 2;
}

.top-bar-log {
  height: 80px;
  background: #3a7ef5ff;
  border-top-left-radius: 12px;
  border-top-right-radius: 12px;
}

.bottom-bar-log {
  height: 55px;
  background: #2575fc;
  justify-content: space-around;
  border-bottom-left-radius: 12px;
  border-bottom-right-radius: 12px;
}

.bottom-bar-log a {
  color: white;
  text-decoration: none;
  font-weight: bold;
  transition: 0.3s;
  font-size: clamp(0.9rem, 3vw, 1rem);
}

.bottom-bar-log a:hover { color: yellow; }

/* ================= Login Page ================= */
#loginPage {
  display: flex;
  flex-direction: column;
  justify-content: flex-start;
  align-items: center;
  min-height: 100vh;
  width: 100%;
  padding: 0 5%;
  box-sizing: border-box;
  overflow-y: auto;
}

#board {
  width: 100%;
  max-width: 600px;
  flex: 1 1 auto;
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 2rem 1rem;
  margin-bottom: 1rem;
  box-shadow: 0 8px 25px rgba(0,0,0,0.2);
  background: rgba(13, 221, 141, 0.95);
  border-radius: 12px;
  animation: fadein 1s ease-in-out;
}

h2 {
  font-size: clamp(1.8rem, 5vw, 3rem);
  margin-bottom: 2rem;
  text-align: center;
  color: red;
}

.inputs {
  width: 100%;
  max-width: 100%;
  padding: 0.8rem;
  margin: 0.8rem 0;
  border-radius: 10px;
  font-size: clamp(1rem, 3vw, 1.5rem);
  background-color: rgba(186, 247, 245, 1);
  border: none;
  outline: 2px solid #ccc;
  transition: 0.3s;
}

.inputs:focus {
  outline: 3px solid #2575fc;
  background-color: #ffffff;
}

#submit {
  width: 90%;
  max-width: 400px;
  padding: 1rem;
  margin-top: 2rem;
  border-radius: 20px;
  font-size: clamp(1rem, 3vw, 1.5rem);
  font-weight: bold;
  border: none;
  cursor: pointer;
  transition: 0.3s;
  outline: 1px groove red;
  background: rgba(216, 202, 13, 1);
}

#submit:hover {
  background: linear-gradient(90deg, #feb47b, #ff7e5f);
  transform: scale(1.05);
}

.links {
  margin-top: 2rem;
  font-weight: 800;
  font-size: clamp(1rem, 3vw, 1.2rem);
  color: rgba(206, 12, 245, 1);
  text-decoration: none;
  transition: 0.3s;
}

.links:hover { color: yellow; }

/* ================= Popup Messages ================= */
#msg {
  width: 90%;
  max-width: 350px;
  height: auto;
  bottom: 5rem;
  left: 50%;
  transform: translateX(-50%);
  position: fixed;
  outline: 2px groove yellow;
  display: none;
  z-index: 20;
}

.prog {
  width: 3rem;
  height: 3rem;
  border-radius: 40px;
  position: absolute;
  top: 2rem;
  left: 4.5rem;
  outline: 10px groove yellow;
  font-size: 40px;
}

#progC {
  transform-style: preserve-3d;
  animation: spin 4s ease-in-out infinite;
}

#msgT, #loginT {
  position: relative;
  color: blue;
  font-weight: 500;
  font-size: large;
  width: 12rem;
  height: 50px;
  top: 6rem;
  left: 1rem;
}

/* ================= Animations ================= */
@keyframes fadein {
  from { opacity: 0; transform: scale(0.95); }
  to { opacity: 1; transform: scale(1); }
}

@keyframes spin {
  0% { transform: rotateY(0deg) rotateX(0deg); }
  50% { transform: rotateY(360deg) rotateX(60deg); }
  100% { transform: rotateY(0deg) rotateX(0deg); }
}

/* ================= Chat Page ================= */
#chatPage { display: none; }

.chat-container {
  flex: 1;
  display: flex;
  flex-direction: column;
  justify-content: flex-start;
  padding: 18px 15px;
  overflow-y: auto;
  background-color: #5fffffff;
  height: auto;
}

.chat-bubble {
  max-width: 80%;
  padding: 14px 18px;
  margin: 10px 0;
  border-radius: 16px;
  font-size: 1rem;
  line-height: 1.4;
  word-wrap: break-word;
}

.chat-left {
  background: #f1f1f1;
  align-self: flex-start;
}

.chat-right {
  background: #602ceeff;
  color: #fff;
  align-self: flex-end;
}

/* Chat input */
.chat-input {
  display: flex;
  padding: 12px 15px;
  background: #3a7ef5ff;
  border-top: 1px solid #ddd;
}

.chat-input input {
  flex: 1;
  padding: 14px 16px;
  border: 1px solid #070000ff;
  border-radius: 20px;
  outline: none;
  font-size: 1rem;
  background-color: #ddd;
}

.chat-input button {
  margin-left: 10px;
  padding: 14px 20px;
  border: none;
  border-radius: 50%;
  background: #05c7adff;
  color: #fff;
  font-size: 1.2rem;
  cursor: pointer;
  transition: 0.2s;
}

.chat-input button:hover { background: #190146ff; }

/* ================= Responsive ================= */
@media (max-width: 1024px) {
  #board { padding: 2rem 1rem; }
  h2 { font-size: clamp(1.6rem, 5vw, 2.5rem); }
  .inputs { font-size: clamp(0.95rem, 3vw, 1.4rem); }
}

@media (max-width: 768px) {
  #loginPage { padding: 0 3%; }
  #board { padding: 1.5rem 1rem; }
  h2 { font-size: clamp(1.5rem, 4.5vw, 2.2rem); }
}

@media (max-width: 480px) {
  #loginPage { padding: 0 2%; }
  #board { padding: 1rem 0.5rem; }
  .inputs { font-size: 0.95rem; padding: 0.6rem; }
  #submit { font-size: 0.95rem; padding: 0.8rem; }
  h2 { font-size: clamp(1.3rem, 4vw, 1.8rem); }
  .top-bar-log, .bottom-bar-log { padding: 8px; font-size: 0.9rem; }
}

  </style>
</head>
<body>
  <!-- Login Page -->
  <div id="loginPage">
    <div class="top-bar-log">
      <div class="settings-btn" id="home" style="font-size: 2.4rem">‚¨ÖÔ∏è</div>
      <p> Unity </p>
    </div>
  <div id="board">
    <h2>Login</h2>
    <input required type="number" class="inputs" id="phoneI" placeholder="Enter Phone Number">
    <input required type="password" class="inputs" id="passI" placeholder="Enter Password">
    <input required type="number" class="inputs" id="phone2I" placeholder="Enter Phone number to chat with...">
    <button id="submit" onclick="f1()">Submit</button>
    <a id="link1" class="links" href="/pages/personalInfo.html">Forgot Password?</a>
    <a class="links" id="link2" href="/pages/signIn.html">Sign Up</a>

    <div id="msg">
      <div id="progC">
        <div id="prog1" class="prog">üî¥</div>
        <div id="prog2" class="prog">üü¢</div>
      </div>
      <p id="loginT">Logging in...</p>
      <h3 id="msgT">No text returned</h3>
    </div>
  </div>

  <!-- Bottom App Bar -->
  <div class="bottom-bar-log">
    <a href="#">üè† Home</a>
    <a href="#">üîç Search</a>
    <a href="#">‚öô Settings</a>
  </div>
</div>


  <!-- Chat Page -->
   <span id="chatPage">
  <div class="top-bar">
    <div style="display: flex; align-items: center;">
      <div class="settings-btn" id="settings">‚ò∞</div>
      <div class="user-info">
        <h2 id="nameinfo"></h2>
        <p id="phoneinfo"></p>
      </div>
    </div>
    <div id="pic"></div>
    <div class="dropdown" id="dropdown">
      <button onclick="toggleDarkMode()">üåô Dark Theme</button>
      <button onclick="openModal()">‚öôÔ∏è Settings</button>
      <button id="connected">üõú See who is connected</button>
      <button onclick="exit()">‚ùå Exit chat</button>
    </div>
  </div>

  <!-- Chat Container -->
  <div class="chat-container" id="chat">
  </div>

  <!-- Chat Input -->
  <div class="chat-input">
    <input type="text" id="message" placeholder="Type a message..." />
    <button id="sendbtn">‚û§</button>
  </div>

  <!-- Settings Modal -->
  <div class="modal" id="modal">
    <div class="modal-content">
      <h3>Settings</h3>
      <label>üé® Pick Background Color</label><br>
      <input type="color" onchange="changeBackgroundColor(this.value)"><br>
      <label>üñº Upload Background</label><br>
      <input type="file" accept="image/*" onchange="uploadBackground(event)"><br>
      <button class="close-btn" onclick="closeModal()">Close</button>
    </div>
  </div>

  <!-- Profile Picture Zoom Modal -->
  <div class="pic-modal" id="picModal" onclick="closePicModal()">
  </div>
</span>

<div id="OnlineInfo" id="modal2" class="modal2">
  <div class="modal-content2">
    <span id="closemodal" class="close">&times;</span>
    <h2>Who's Online</h2>
    <ol id="onlineList"></ol>
  </div>
</div>
  <script>
    let home= document.getElementById("home")
  home.addEventListener("click", ()=>{
      window.location.href="/pages/home.html"
  })
    //Login Page
  let bt1= document.getElementById("submit")
  let msgT= document.getElementById("msgT")
  let msg= document.getElementById("msg")
  let phoneC= document.getElementById("phoneI");
  let passC= document.getElementById("passI")
  let loginPage= document.getElementById("loginPage");
  let pic= document.getElementById("pic");
  let nameinfo= document.getElementById("nameinfo");
  let phoneinfo= document.getElementById("phoneinfo");
  let sendbt= document.getElementById("sendbtn");
  let settings= document.getElementById("settings");
  let ol= document.getElementById("onlineList");
  let closemodal = document.getElementById("closemodal");
  let modal2= document.querySelector(".modal2");
  let connected= document.getElementById("connected");
  let dropdown = document.getElementById("dropdown");
  let messageBox= document.getElementById("message");

  closemodal.addEventListener("click", ()=>{
    modal2.style.display="none"
  })
  function exit(){
    window.location.href="/pages/home.html"
  }
  settings.addEventListener("click", ()=>{
    setTimeout(()=>{
      dropdown.style.display="none"
    }, 6000);
     dropdown.style.display = dropdown.style.display==="flex"?"none":"flex"; })
      function toggleDarkMode() { document.body.classList.toggle("dark"); }
      function openModal() { document.getElementById("modal").style.display="flex"; document.getElementById("dropdown").style.display="none"; }
      function closeModal() { document.getElementById("modal").style.display="none"; }
      function changeBackgroundColor(color) { document.body.style.background=color; }
      function uploadBackground(event) {
        const file = event.target.files[0];
        if(file){
          const reader = new FileReader();
          reader.onload = function(e){
            document.body.style.background = `url(${e.target.result}) no-repeat center/cover`;
            document.body.style.backgroundSize = "cover";
          }
          reader.readAsDataURL(file);
        }
      }

  function f1(){
    let phoneI= document.getElementById("phoneI").value;
    let passI= document.getElementById("passI").value;
    let phone2I= document.getElementById("phone2I").value;
  
    fetch("/chat/path1",{
      method: "POST",
      headers: {"Content-Type":"application/json"},
      body: JSON.stringify({phone: `${phoneI}`, pass: `${passI}`, phone2: `${phone2I}`})
    })
    .then(type=> type.json())
    .then(data=>{
      if(data.name=="Null"){
        phoneC.style.color="red";
        phoneC.type="text";
        phoneC.value+=" Is Not Found";
  
        setTimeout(()=>{
          phoneC.style.color="blue";
          phoneC.type="number";
        }, 4000);
      } else {
        msg.style.display="block";
        msgT.innerHTML=`Welcome Back ${data.info1.name}!`;
        setTimeout(()=>{
          loginPage.style.display="none";
          chatPage.style.display="block";
        }, 80);
      }
  
      //Chat Page Inside Data
      pic.style.background= `url(/pictures/${data.info2.piclink})`;
      nameinfo.innerHTML= `${data.info2.name}`;
      phoneinfo.innerHTML= `${data.info2.phone}`;
      pic.style.backgroundSize= "cover";
  
      // Typing effect for bot
      function typeMessage(text, container) {
        container.style.whiteSpace = "pre-wrap";
        let i = 0;
        const interval = setInterval(() => {
          container.textContent += text.charAt(i);
          i++;
          if (i === text.length) clearInterval(interval);
        }, 50);
      }
      
      
      function send(){
        const input = document.getElementById("message");
        const text = input.value;
        if (text === "") return;
  
        const chat = document.getElementById("chat");
        const bubble = document.createElement("div");
        bubble.className = "chat-bubble chat-right";
        bubble.textContent = text;            // use textContent, not innerText
        bubble.style.whiteSpace = "pre-wrap";
        
        chat.appendChild(bubble);
        chat.scrollTop = chat.scrollHeight;
        input.value = "";
  
        fetch("/chat/path2", {
          method: "POST",
          headers: {"Content-Type":"application/json"},
          body: JSON.stringify({
            phone1: data.info1.phone,
            input: text,
            phone2: data.info2.phone
          })
        })
      };
      sendbt.addEventListener("click", send);
      messageBox.addEventListener("keydown", function(event) {
        if(event.key === "Enter") {
            event.preventDefault(); // prevent line break if textarea
            send();
        }
    });
      // Profile pic zoom modal
      const picModal = document.getElementById("picModal");
      const modalImg = document.getElementById("modalImg");
  
      pic.addEventListener("click", ()=>{
        picModal.style.display = "flex";
      });
  
      function closePicModal(){
        const img = document.querySelector("#picModal img");
        img.style.animation = "zoomOut 0.3s forwards";
        setTimeout(()=>{
          picModal.style.display = "none";
          img.style.animation = "zoomIn 0.4s forwards";
        }, 300);
      }

      let lastMessage = ""; // track last message

      setInterval(() => {
        fetch("/chat/path3", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ phone1: data.info1.phone })
        })
        .then(res => res.json())
        .then(data => {
          if (data.msg !== lastMessage) { // only act if message changed
            lastMessage = data.msg; // update lastMessage
      
            const typing = document.createElement("div");
            typing.className = "typing-indicator";
            chat.appendChild(typing);
            chat.scrollTop = chat.scrollHeight;
      
            setTimeout(() => {
              typing.remove();
      
              const reply = document.createElement("div");
              reply.className = "chat-bubble chat-left";
              reply.style.whiteSpace = "pre-wrap";
              chat.appendChild(reply);
      
              typeMessage(data.msg, reply);
              chat.scrollTop = chat.scrollHeight;
            }, 1500);
          }
        });
      }, 6000);
      
    });
  }

  connected.addEventListener("click", ()=>{
  fetch("/path/online")
  .then(type=> type.json())
  .then(data=>{
    data.everyone.forEach((user, index)=>{
        const li = document.createElement("li");
        li.textContent = `${user.name}- ${user.phone}`;
        ol.appendChild(li);
        modal2.style.display="block"
    })
});
  })
  </script>
</body>
</html>