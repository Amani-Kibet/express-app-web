<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <title>Chat</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    html, body {
      height: 100%;
      width: 100%;
      font-family: Arial, sans-serif;
      background: linear-gradient(135deg, cyan, lightblue);
      overflow: hidden;
    }
    body {
      margin: 0;
      font-family: "Poppins", sans-serif;
      background: linear-gradient(135deg, #667eea, #764ba2);
      height: 100vh;
      display: flex;
      flex-direction: column;
      color: #333;
      transition: background 0.3s, color 0.3s;
      font-size: 16px;
    }

    /* Top bar */
    .top-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px 20px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
      position: relative;
      z-index: 2;
      width: 100%;
      height: 80px;
      background: #3a7ef5ff;
      color: white;
      border-top-left-radius: 12px;
      border-top-right-radius: 12px;
    }

    /* Login Page */
    #loginPage {
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      align-items: center;
      padding: 0 2%;
      position: relative;
      top: 5%;
      left: 1%;
    }
    #board {
      width: 100%;
      max-width: 600px;
      display: flex;
      flex-direction: column;
      align-items: center;
      flex: 1;
      overflow-y: auto;
      padding: 2rem 0;
      box-shadow: 0 8px 25px rgba(0,0,0,0.3);
      background: rgba(13, 221, 141, 0.95);
      animation: fadein 1s ease-in-out;
    }
    .top-bar-log {
      width: 100%;
      height: 50px;
      background: #2575fc;
      color: white;
      display: flex;
      font-weight: bold;
      font-size: 1.8rem;
      border-top-left-radius: 12px;
      border-top-right-radius: 12px;
      gap: 22%;
    }
    .bottom-bar-log {
      width: 100%;
      height: 55px;
      background: #2575fc;
      color: white;
      display: flex;
      align-items: center;
      justify-content: space-around;
      font-size: 1rem;
      border-bottom-left-radius: 12px;
      border-bottom-right-radius: 12px;
    }

    .bottom-bar-log a {
      color: white;
      text-decoration: none;
      font-weight: bold;
      transition: 0.3s;
    }

    .bottom-bar-log a:hover {
      color: yellow;
    }
    h2 {
      color: red;
      font-size: clamp(2rem, 6vw, 4rem);
      margin-bottom: 2rem;
      text-align: center;
    }

    .inputs {
      width: 90%;
      padding: 1rem;
      margin: 1rem 0;
      border-radius: 10px;
      font-size: clamp(1rem, 3vw, 1.5rem);
      background-color: rgba(186, 247, 245, 1);
      border: none;
      outline: 2px solid #ccc;
      transition: 0.3s;
    }

    .inputs:focus {
      outline: 3px solid #2575fc;
      background-color: #ffffffff;
    }

    #submit {
      background: rgba(216, 202, 13, 1);;
      width: 70%;
      padding: 1rem;
      margin-top: 2rem;
      border-radius: 20px;
      font-size: clamp(1rem, 3vw, 1.5rem);
      font-weight: bold;
      border: none;
      cursor: pointer;
      transition: 0.3s;
      outline: 1px groove red;
    }

    #submit:hover {
      background: linear-gradient(90deg, #feb47b, #ff7e5f);
      transform: scale(1.05);
    }

    .links {
      margin-top: 2rem;
      font-weight: 800;
      font-size: clamp(1rem, 3vw, 1.2rem);
      color: rgba(206, 12, 245, 1);
      text-decoration: none;
      transition: 0.3s;
    }

    .links:hover {
      color: yellow;
    }

    #msg{
      background: lightblue;
      width: 18rem;
      height: 18rem;
      border-radius: 10px;
      position: absolute;
      bottom: 16rem;
      left: 3rem;
      outline: 2px groove yellow;
      display: none;
      z-index: 20;
  
    }
    .prog{
      width: 3rem;
      height: 3rem;
      border-radius: 40px;
      position: absolute;
      top: 2rem;
      left: 4.5rem;
      outline: 10px groove yellow;
      font-size: 40px;
    }
    #prog2{
        transform: rotateY(90deg)
    }
    #progC{
      transform-style: preserve-3d;
      animation: spin 4s ease-in-out infinite;
    }
    #msgT{
      position: relative;
      top: 6rem;
      left: 1rem;
      color: blue;
      font-weight: 500;
      font-size: large;
      width: 12rem;
      height: 50px;
    }
    #loginT{
      position: relative;
      top: 6rem;
      left: 1rem;
      color: rgb(255, 60, 0);
      font-weight: 500;
      font-size: large;
      width: 12rem;
      height: 50px;
    }

    @keyframes fadein {
      from { opacity: 0; transform: scale(0.95); }
      to { opacity: 1; transform: scale(1); }
    }

    /* Chat Page */

    .user-info h2 {
      margin: 0;
      font-size: 1.2rem;
      color: #ffffffff;
    }

    .user-info p {
      margin: 2px 0 0;
      font-size: 1rem;
      color: #d0f8fcff;
    }

    #pic {
      width: 65px;
      height: 65px;
      border-radius: 50%;
      background: cyan;
      background-size: cover;
      border: 2px solid #eee;
      cursor: pointer;
    }

    .settings-btn {
      font-size: 1.4rem;
      cursor: pointer;
      margin-right: 10px;
    }

    .dropdown {
      position: absolute;
      top: 60px;
      left: 15px;
      background: #e9f8f7ff;
      border-radius: 10px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.2);
      overflow: hidden;
      display: none;
      flex-direction: column;
      width: 180px;
      z-index: 5;
      animation:slideUp 0.5s ease;
    }

    .dropdown button {
      border: none;
      padding: 12px 15px;
      text-align: left;
      font-size: 1rem;
      cursor: pointer;
      width: 100%;
      transition: background 0.2s;
      outline: 2px groove #f0f0f0d0;
    }

    .dropdown button:hover { background: #f0f0f0; }

    /* Chat container */
.chat-container {
  flex: 1;
  display: flex;
  flex-direction: column;
  justify-content: flex-start;
  padding: 18px 15px;
  overflow-y: auto;
  background-color: #5fffffff;
  height: 68vh;
}
#chatPage{
  display: none;
}
    .chat-bubble {
      max-width: 80%;
      padding: 14px 18px;
      margin: 10px 0;
      border-radius: 16px;
      font-size: 1rem;
      line-height: 1.4;
      word-wrap: break-word;
    }

    .chat-left {
      background: #f1f1f1;
      align-self: flex-start;
      border-top-left-radius: 1px;
    }

    .chat-right {
      background: #602ceeff;
      color: #fff;
      align-self: flex-end;
      border-top-right-radius: 1px;
    }

    /* Chat input */
    .chat-input {
      display: flex;
      padding: 12px 15px;
      background: #3a7ef5ff;
      border-top: 1px solid #ddd;
    }

    .chat-input input {
      flex: 1;
      padding: 14px 16px;
      border: 1px solid #070000ff;
      border-radius: 20px;
      outline: none;
      font-size: 1rem;
      background-color:#ddd
    }

    .chat-input button {
      margin-left: 10px;
      padding: 14px 20px;
      border: none;
      border-radius: 50%;
      background: #05c7adff;
      color: #fff;
      font-size: 1.2rem;
      cursor: pointer;
      transition: 0.2s;
    }

    .chat-input button:hover { background: ##190146ff; }

    /* Dark theme */
    body.dark .chat-container {
      background: #075e64ff;
      color: #ddd;
    }
    body.dark {
      background: cyan;
      color: #ddd;
    }
    body.dark .top-bar { background: #34058bff; color: #ddd; }
    body.dark .dropdown { background: #2c2c2c; color: #000000ff; }
    body.dark .chat-left { background: #268608ff; color: #ffffffff; }
    body.dark .chat-right { background: #0f9badff;
    color: white }

    /* Settings modal */
    .modal {
      display: none;
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.5);
      justify-content: center;
      align-items: center;
      z-index: 20;
    }

    .modal-content {
      background: #fff;
      padding: 20px;
      border-radius: 12px;
      width: 90%;
      max-width: 350px;
      text-align: center;
      box-shadow: 0 6px 20px rgba(0,0,0,0.3);
    }

    .close-btn {
      background: #667eea;
      color: #fff;
      border: none;
      padding: 10px 16px;
      border-radius: 6px;
      cursor: pointer;
      margin-top: 10px;
    }

    /* Neon typing indicator */
    .typing-indicator {
      background-color: black;
      width: 50px;
      height: 50px;
      border-radius: 50%;
      border: 3px solid transparent;
      border-top: 4px solid #00ffe0;
      border-right: 4px solid #ff00ff;
      border-bottom: 6px solid #00ff88;
      border-left: 6px solid #ffea00;
      animation: spin 1.2s linear infinite, neon-glow 1.5s ease-in-out infinite alternate;
      margin: 10px 0;
      align-self: flex-start;
    }

    @keyframes spin {
      0% { transform: rotateY(0deg) rotateX(0deg); }
      50% { transform: rotateY(360deg) rotateX(60deg); }
      100% { transform: rotateY(0deg) rotateX(0deg); }
    }
    @keyframes neon-glow {
      0%{box-shadow:0 0 8px #0ff,0 0 15px #0ff;}
      100%{box-shadow:0 0 20px #f0f,0 0 40px #ff0;}
    }

    /* Profile pic zoom modal */
    .pic-modal {
      display: none;
      position: fixed;
      top:0; left:0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.7);
      justify-content: center;
      align-items: center;
      z-index: 50;
      animation: fadeIn 0.3s ease;
    }
    .pic-modal img {
      max-width: 80%;
      max-height: 80%;
      border-radius: 12px;
      box-shadow: 0 0 30px rgba(0,0,0,0.5);
      transform: scale(0.5);
      animation: zoomIn 0.4s forwards;
    }
    @keyframes fadeIn { from{background:rgba(0,0,0,0);} to{background:rgba(0,0,0,0.7);} }
    @keyframes zoomIn { from{transform:scale(0.3);opacity:0;} to{transform:scale(1);opacity:1;} }
    @keyframes zoomOut { from{transform:scale(1);opacity:1;} to{transform:scale(0.3);opacity:0;} }

    .modal2 {
      display:none;
       position:fixed; z-index:10; left:0; top:0; width:100%; height:100%;
      background:rgba(0,0,0,0.7); animation:fadeIn2 0.4s;
    }
    .modal-content2 {
      background:#111; color:#fff; margin:8% auto; padding:25px; border-radius:15px;
      width:90%; max-width:500px; text-align:left; box-shadow:0 8px 25px rgba(0,0,0,0.6);
      animation:slideUp 0.5s ease;
    }
    .modal-content2 h2 { margin-bottom:15px; color:#00c6ff; }
    .close { float:right; font-size:22px; font-weight:bold; cursor:pointer; color:#ff4b5c; }
    .close:hover { color:#ff1e3c; }
  
    @keyframes fadeIn2 { from{opacity:0;} to{opacity:1;} }
    @keyframes slideUp { from{transform:translateY(40px); opacity:0;} to{transform:translateY(0); opacity:1;} }
    @keyframes fadeInDown { from{opacity:0; transform:translateY(-30px);} to{opacity:1; transform:translateY(0);} }
  </style>
</head>
<body>
  <!-- Login Page -->
  <div id="loginPage">
    <div class="top-bar-log">
      <div class="settings-btn" id="home" style="font-size: 2.4rem">⬅️</div>
      <p> Unity </p>
    </div>
  <div id="board">
    <h2>Login</h2>
    <input required type="number" class="inputs" id="phoneI" placeholder="Enter Phone Number">
    <input required type="password" class="inputs" id="passI" placeholder="Enter Password">
    <input required type="number" class="inputs" id="phone2I" placeholder="Enter Phone number to chat with...">
    <button id="submit" onclick="f1()">Submit</button>
    <a id="link1" class="links" href="/pages/personalInfo.html">Forgot Password?</a>
    <a class="links" id="link2" href="/pages/signIn.html">Sign Up</a>

    <div id="msg">
      <div id="progC">
        <div id="prog1" class="prog">🔴</div>
        <div id="prog2" class="prog">🟢</div>
      </div>
      <p id="loginT">Logging in...</p>
      <h3 id="msgT">No text returned</h3>
    </div>
  </div>

  <!-- Bottom App Bar -->
  <div class="bottom-bar-log">
    <a href="#">🏠 Home</a>
    <a href="#">🔍 Search</a>
    <a href="#">⚙ Settings</a>
  </div>
</div>


  <!-- Chat Page -->
   <span id="chatPage">
  <div class="top-bar">
    <div style="display: flex; align-items: center;">
      <div class="settings-btn" id="settings">☰</div>
      <div class="user-info">
        <h2 id="nameinfo"></h2>
        <p id="phoneinfo"></p>
      </div>
    </div>
    <div id="pic"></div>
    <div class="dropdown" id="dropdown">
      <button onclick="toggleDarkMode()">🌙 Dark Theme</button>
      <button onclick="openModal()">⚙️ Settings</button>
      <button id="connected">🛜 See who is connected</button>
      <button onclick="exit()">❌ Exit chat</button>
    </div>
  </div>

  <!-- Chat Container -->
  <div class="chat-container" id="chat">
    <div class="chat-bubble chat-left">Hey, welcome to your chat!</div>
    <div class="chat-bubble chat-right">Thanks, it looks cool 😎</div>
  </div>

  <!-- Chat Input -->
  <div class="chat-input">
    <input type="text" id="message" placeholder="Type a message..." />
    <button id="sendbtn">➤</button>
  </div>

  <!-- Settings Modal -->
  <div class="modal" id="modal">
    <div class="modal-content">
      <h3>Settings</h3>
      <label>🎨 Pick Background Color</label><br>
      <input type="color" onchange="changeBackgroundColor(this.value)"><br>
      <label>🖼 Upload Background</label><br>
      <input type="file" accept="image/*" onchange="uploadBackground(event)"><br>
      <button class="close-btn" onclick="closeModal()">Close</button>
    </div>
  </div>

  <!-- Profile Picture Zoom Modal -->
  <div class="pic-modal" id="picModal" onclick="closePicModal()">
  </div>
</span>

<div id="OnlineInfo" id="modal2" class="modal2">
  <div class="modal-content2">
    <span id="closemodal" class="close">&times;</span>
    <h2>Who's Online</h2>
    <ol id="onlineList"></ol>
  </div>
</div>
  <script>
    let home= document.getElementById("home")
  home.addEventListener("click", ()=>{
      window.location.href="/pages/home.html"
  })
    //Login Page
  let bt1= document.getElementById("submit")
  let msgT= document.getElementById("msgT")
  let msg= document.getElementById("msg")
  let phoneC= document.getElementById("phoneI");
  let passC= document.getElementById("passI")
  let loginPage= document.getElementById("loginPage");
  let pic= document.getElementById("pic");
  let nameinfo= document.getElementById("nameinfo");
  let phoneinfo= document.getElementById("phoneinfo");
  let sendbt= document.getElementById("sendbtn");
  let settings= document.getElementById("settings");
  let ol= document.getElementById("onlineList");
  let closemodal = document.getElementById("closemodal");
  let modal2= document.querySelector(".modal2");
  let connected= document.getElementById("connected");
  let dropdown = document.getElementById("dropdown");

  closemodal.addEventListener("click", ()=>{
    modal2.style.display="none"
  })
  function exit(){
    window.location.href="/pages/home.html"
  }
  settings.addEventListener("click", ()=>{
    setTimeout(()=>{
      dropdown.style.display="none"
    }, 6000);
     dropdown.style.display = dropdown.style.display==="flex"?"none":"flex"; })
      function toggleDarkMode() { document.body.classList.toggle("dark"); }
      function openModal() { document.getElementById("modal").style.display="flex"; document.getElementById("dropdown").style.display="none"; }
      function closeModal() { document.getElementById("modal").style.display="none"; }
      function changeBackgroundColor(color) { document.body.style.background=color; }
      function uploadBackground(event) {
        const file = event.target.files[0];
        if(file){
          const reader = new FileReader();
          reader.onload = function(e){
            document.body.style.background = `url(${e.target.result}) no-repeat center/cover`;
            document.body.style.backgroundSize = "cover";
          }
          reader.readAsDataURL(file);
        }
      }

  function f1(){
    let phoneI= document.getElementById("phoneI").value;
    let passI= document.getElementById("passI").value;
    let phone2I= document.getElementById("phone2I").value;
  
    fetch("/path4",{
      method: "POST",
      headers: {"Content-Type":"application/json"},
      body: JSON.stringify({phone: `${phoneI}`, pass: `${passI}`, phone2: `${phone2I}`})
    })
    .then(type=> type.json())
    .then(data=>{
      if(data.name=="Null"){
        phoneC.style.color="red";
        phoneC.type="text";
        phoneC.value+=" Is Not Found";
  
        setTimeout(()=>{
          phoneC.style.color="blue";
          phoneC.type="number";
        }, 4000);
      } else {
        msg.style.display="block";
        msgT.innerHTML=`Welcome Back ${data.info1.name}!`;
        setTimeout(()=>{
          loginPage.style.display="none";
          chatPage.style.display="block";
        }, 80);
      }
  
      //Chat Page Inside Data
      pic.style.background= `url(/pictures/${data.info2.piclink})`;
      nameinfo.innerHTML= `${data.info2.name}`;
      phoneinfo.innerHTML= `${data.info2.phone}`;
      pic.style.backgroundSize= "cover";
  
      // Typing effect for bot
      function typeMessage(text, container) {
        container.style.whiteSpace = "pre-wrap";
        let i = 0;
        const interval = setInterval(() => {
          container.textContent += text.charAt(i);
          i++;
          if (i === text.length) clearInterval(interval);
        }, 50);
      }
      
      
      sendbt.addEventListener("click", () => {
        const input = document.getElementById("message");
        const text = input.value;
        if (text === "") return;
  
        const chat = document.getElementById("chat");
        const bubble = document.createElement("div");
        bubble.className = "chat-bubble chat-right";
        bubble.textContent = text;            // use textContent, not innerText
        bubble.style.whiteSpace = "pre-wrap";
        
        chat.appendChild(bubble);
        chat.scrollTop = chat.scrollHeight;
        input.value = "";
  
        fetch("/path5", {
          method: "POST",
          headers: {"Content-Type":"application/json"},
          body: JSON.stringify({
            phone1: data.info1.phone,
            input: text,
            phone2: data.info2.phone
          })
        })
        .then(type => type.json())
        .then(data => {
          const typing = document.createElement("div");
          typing.className = "typing-indicator";
          chat.appendChild(typing);
          chat.scrollTop = chat.scrollHeight;
        
          setTimeout(() => {
            typing.remove();
            const reply = document.createElement("div");
            reply.className = "chat-bubble chat-left";
            reply.style.whiteSpace = "pre-wrap";

            chat.appendChild(reply);
            typeMessage(data.reply, reply);

            chat.scrollTop = chat.scrollHeight;
          }, 1500);
        });
      });
  
      // Profile pic zoom modal
      const picModal = document.getElementById("picModal");
      const modalImg = document.getElementById("modalImg");
  
      pic.addEventListener("click", ()=>{
        picModal.style.display = "flex";
      });
  
      function closePicModal(){
        const img = document.querySelector("#picModal img");
        img.style.animation = "zoomOut 0.3s forwards";
        setTimeout(()=>{
          picModal.style.display = "none";
          img.style.animation = "zoomIn 0.4s forwards";
        }, 300);
      }
    });
  }

  connected.addEventListener("click", ()=>{
  fetch("/path6")
  .then(type=> type.json())
  .then(data=>{
    data.everyone.forEach((user, index)=>{
        const li = document.createElement("li");
        li.textContent = `${user.name}- ${user.phone}`;
        ol.appendChild(li);
        modal2.style.display="block"
    })
});
  })
  </script>
</body>
</html>