<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Profile Update</title>
<style>
* { margin:0; padding:0; box-sizing:border-box; font-family:'Poppins', sans-serif; }

/* Body */
body {
  display:flex; flex-direction:column; align-items:flex-start; padding:10px;
  background: linear-gradient(135deg, #70eea0ff, #60f0adff);
  min-height:100vh;
}

/* Top bar */
.top-bar-prof {
  width:100%; max-width:600px; height:55px; background:#2575fc; color:#fff;
  display:flex; align-items:center; font-weight:bold; font-size:1.5rem;
  border-top-left-radius:12px; border-top-right-radius:12px; padding:0 10px;
  margin-bottom:1rem;
}

/* Board */
#board {
  width:100%;
  max-width:600px;
  display:flex; flex-direction:column; align-items:center;
  flex:1; overflow-y:auto; padding:2rem 0; box-shadow:0 8px 25px black;
  background: rgba(13, 221, 141, 0.95); max-height:68vh;
}

/* Form */
form { width:90%; display:flex; flex-direction:column; align-items:center; }

h2 { color:red; font-size:1.6rem; margin-bottom:5%; }

/* Inputs */
.inputs {
  width:90%; padding:1rem; margin:0.4rem 0; border-radius:10px;
  font-size:clamp(1rem,3vw,1.5rem); background-color: rgba(186, 247, 245,1);
  border:none; outline:2px solid #ccc; transition:0.3s;
}
.inputs:focus { outline:3px solid #2575fc; background-color:#fff; }

/* Submit */
#submit {
  background: rgba(216, 202, 13, 1); width:70%; padding:1rem; margin-top:2rem;
  border-radius:20px; font-size:clamp(1rem,3vw,1.5rem); font-weight:bold;
  border:none; cursor:pointer; transition:0.3s; outline:1px groove red;
}
#submit:hover { background: linear-gradient(90deg, #09319e, #5abfee); transform:scale(0.95); }

/* Bottom Bar */
.bottom-bar-prof { width:100%; max-width:600px; height:60px; background:#2575fc; color:#fff;
display:flex; align-items:center; justify-content:space-around; font-size:1rem;
border-bottom-left-radius:12px; border-bottom-right-radius:12px; margin-top:1rem; }
.bottom-bar-prof a { color:white; text-decoration:none; font-weight:bold; transition:0.3s; }
.bottom-bar-prof a:hover { color:yellow; }

/* File Inputs */
.file-inputs { display:grid; grid-template-columns:repeat(auto-fit,minmax(100px,1fr)); gap:12px; width:90%; margin-top:0.5rem; }
.file-inputs input { background: rgba(186, 247, 245, 1); padding:10px; border-radius:10px; cursor:pointer; }

/* ===== Popups ===== */
.popup-bg {
  display:none; position:fixed; top:0; left:0; width:100%; height:100%;
  background:rgba(0,0,0,0.7); justify-content:center; align-items:center; z-index:999;
}
.popup {
  background:#fff; border-radius:15px; padding:2rem; width:90%; max-width:400px;
  display:flex; flex-direction:column; gap:1rem; text-align:center; position:relative;
}
.popup h3 { color:#2575fc; margin-bottom:1rem; }
.popup button { padding:10px 15px; border:none; border-radius:10px; cursor:pointer; background:#2575fc; color:#fff; font-weight:bold; transition:0.3s; }
.popup button:hover { background:#09319e; }

/* Message Popup */
#msgPopup {
  display:none; position:fixed; top:20px; right:20px; background:#2575fc; color:#fff;
  padding:15px 20px; border-radius:10px; box-shadow:0 4px 15px rgba(0,0,0,0.2);
  font-weight:bold; z-index:1000; animation: slideMsg 0.5s forwards;
}
@keyframes slideMsg { from {transform:translateX(100%);} to {transform:translateX(0);} }
</style>
</head>
<body>

<div class="top-bar-prof">
  <div class="back-btn" onclick="window.location.href='/pages/chat.html'" style="margin-right:20%">‚¨ÖÔ∏è</div>
  Profile Centre
</div>

<!-- Form Board -->
<div id="board">
  <h2>Update Your Profile</h2>
  <form id="profileForm" enctype="multipart/form-data">
    <input type="text" name="name" placeholder="Full Name" class="inputs" required>
    <input type="tel" name="phone" placeholder="Phone Number" class="inputs" required>
    <input type="email" name="email" placeholder="Email Address" class="inputs" required>
    <input type="number" name="age" placeholder="Age" class="inputs" min="10" max="100" required>
    <select name="gender" class="inputs" required>
      <option value="">Select Gender</option>
      <option>Male</option>
      <option>Female</option>
      <option>Other</option>
    </select>
    <input type="text" name="county" placeholder="County" class="inputs" required>
    <input type="password" name="password" placeholder="New Password" class="inputs" id="password">
    <input type="password" name="confirmPassword" placeholder="Confirm Password" class="inputs" id="confirmPassword">

    <label style="color:red; margin-top:1rem;">Post up to 6 Photos</label>
    <div class="file-inputs">
      <input type="file" name="photos" accept="image/*">
      <input type="file" name="photos" accept="image/*">
      <input type="file" name="photos" accept="image/*">
      <input type="file" name="photos" accept="image/*">
      <input type="file" name="photos" accept="image/*">
      <input type="file" name="photos" accept="image/*">
    </div>

    <button type="submit" id="submit">Save Profile</button>
  </form>
</div>

<div class="bottom-bar-prof">
  <a href="/pages/chat.html">üè† Home</a>
  <a href="#">üîä Announcements</a>
  <a href="/pages/help.html">‚ùî Help</a>
</div>

<!-- Login Popup -->
<div class="popup-bg" id="loginPopup">
  <div class="popup">
    <h3>Confirm Your Identity</h3>
    <input type="tel" id="popupPhone" placeholder="Phone Number" class="inputs">
    <input type="password" id="popupPassword" placeholder="Password" class="inputs">
    <button id="loginBtn">Confirm</button>
  </div>
</div>

<!-- Message Popup -->
<div id="msgPopup"></div>

<script>
const loginPopup = document.getElementById('loginPopup');
const loginBtn = document.getElementById('loginBtn');
const msgPopup = document.getElementById('msgPopup');
let userToken = null; // store user info temporarily

// Show login popup on page load
window.addEventListener('load', () => { loginPopup.style.display='flex'; });

// Show custom message
function showMsg(text, color='#2575fc') {
  msgPopup.innerText = text;
  msgPopup.style.background = color;
  msgPopup.style.display = 'block';
  setTimeout(()=>{ msgPopup.style.display='none'; },3000);
}

// Handle login confirmation
loginBtn.addEventListener('click', async () => {
  const phone = document.getElementById('popupPhone').value.trim();
  const password = document.getElementById('popupPassword').value.trim();

  // Validate input
  if(!phone || !password) {
    showMsg("Please fill both fields!", "red");
    return;
  }

  try {
    // Use your simple MongoDB lookup
    const res = await fetch('/confirm-user', { // or '/chat/path1' if you prefer
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ phone, password })
    });

    const data = await res.json();

    if(data.success){
      // Store user ID or token
      userToken = data.userId;

      // Hide login popup
      loginPopup.style.display = 'none';

      // Nice success popup
      showMsg("‚úÖ Identity confirmed", "green");

      // Optional: redirect or load user data
      // window.location.href = '/pages/chat.html';
    } else {
      // Show error message nicely
      showMsg(data.message || "‚ùå Invalid credentials", "red");
    }

  } catch(e){
    console.error(e);
    showMsg("‚ùå Error connecting to server", "red");
  }
});


// Handle profile form submit
const form = document.getElementById('profileForm');
form.addEventListener('submit', async e => {
  e.preventDefault();
  if(!userToken){ showMsg("Confirm your identity first!","red"); return; }

  const password = document.getElementById('password').value;
  const confirmPassword = document.getElementById('confirmPassword').value;
  if(password && password !== confirmPassword){ showMsg("Passwords do not match!","red"); return; }

  const formData = new FormData(form);
  formData.append('userId', userToken); // send user id

  try{
    const res = await fetch('/update-profile', { method:'POST', body:formData });
    const data = await res.json();
    showMsg(data.message || "Profile updated successfully!","green");
  } catch(err){ console.error(err); showMsg("Upload failed. Try again!","red"); }
});
</script>

</body>
</html>
